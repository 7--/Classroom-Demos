CREATE USER demo
IDENTIFIED BY p4ssw0rd
DEFAULT TABLESPACE users
TEMPORARY TABLESPACE temp
QUOTA 10M ON users;

GRANT connect to demo;
GRANT resource to demo;
GRANT create session to demo;
GRANT create table to demo;
GRANT create view to demo;

CONN demo/p4ssw0rd;

/*This is DDL*/
create table "PERSON" (
    P_ID NUMBER PRIMARY KEY,
    P_NAME VARCHAR2(200),
    P_AGE INTEGER,
    P_STATE VARCHAR2(50)
);

/*Alter table*/
ALTER TABLE PERSON 
    MODIFY P_ID INTEGER;
    
/*Adding data (DML)*/
INSERT INTO PERSON VALUES(1, 'Bob', 26, 'HI');
Insert into person values(2, 'Sam', 21, 'MA');
insert into person(p_id, P_NAME) values(4, 'Mike');

/*Queries (DML/DQL)*/
SELECT * FROM PERSON;
SELECT P_ID, P_NAME FROM PERSON;

/*CAN USE operators on numerics, or join chars with +*/
SELECT P_AGE * P_AGE FROM PERSON;
SELECT P_AGE * P_AGE AS AGESQUARED FROM PERSON;

/*Alias keyword AS*/
SELECT 'FIRST NAME', P_NAME FROM PERSON;
SELECT P_NAME AS FIRST_NAME, P_STATE FROM PERSON;

/*Group By: reduce rows to distinct values*/
INSERT INTO PERSON VALUES (5, 'Sarah', 31, 'HI');
SELECT P_STATE FROM PERSON
    GROUP BY P_STATE;
    
/*Aggregate functions (AVG, MIN, MAX, SUM, COUNT)
  Performs an action on entire column*/
SELECT AVG(P_AGE), P_STATE FROM PERSON GROUP BY P_STATE;
SELECT COUNT(P_STATE), P_STATE FROM PERSON GROUP BY P_STATE;

/*Scalar functions, operate on individual entries (LOWER, UPPER, NVL)*/
SELECT UPPER(P_NAME) FROM PERSON;
SELECT LOWER(P_NAME) FROM PERSON WHERE P_ID = 5;
SELECT NVL(P_AGE, 0) FROM PERSON;

/*Order By*/
SELECT * FROM PERSON ORDER BY P_NAME;
SELECT * FROM PERSON ORDER BY P_ID DESC;
SELECT * FROM PERSON ORDER BY P_AGE, P_STATE ASC;
INSERT INTO PERSON VALUES (6, 'Bob', 22, 'AL');
INSERT INTO PERSON VALUES (7, 'Jack', 26, 'TX');
SELECT P_AGE, P_NAME FROM PERSON GROUP BY P_AGE, P_NAME ORDER BY P_AGE;

/*WHERE vs. HAVING*/
SELECT * FROM PERSON WHERE P_AGE != 26;
SELECT P_STATE, AVG(P_AGE) FROM PERSON GROUP BY P_STATE HAVING AVG(P_AGE) > 27;
--Having is for aggregate functions with group by clauses

/*Joins*/
CREATE TABLE DEPARTMENT (
    D_ID INTEGER PRIMARY KEY,
    D_NAME VARCHAR2(100) NOT NULL
);

CREATE TABLE PHONE_NUMBERS (
    P_ID INTEGER PRIMARY KEY,
    P_NUMBER VARCHAR2(20)
);

CREATE TABLE EMPLOYEES (
    E_ID INTEGER PRIMARY KEY,
    E_NAME VARCHAR2(2000) NOT NULL,
    E_HIRED DATE,
    E_DEPT INTEGER,
    E_PHONE INTEGER UNIQUE,
    FOREIGN KEY (E_DEPT) REFERENCES DEPARTMENT(D_ID),
    FOREIGN KEY (E_PHONE) REFERENCES PHONE_NUMBERS(P_ID)
);

INSERT INTO DEPARTMENT VALUES (1, 'SALES');
INSERT INTO DEPARTMENT VALUES (2, 'HR');
INSERT INTO DEPARTMENT VALUES (3, 'TRAINING');

INSERT INTO PHONE_NUMBERS VALUES (100, '(281) 586-4839');
INSERT INTO PHONE_NUMBERS VALUES (101, '(285) 574-0374');
INSERT INTO PHONE_NUMBERS VALUES (102, '(249) 587-4739');
INSERT INTO PHONE_NUMBERS VALUES (103, '(555) 555-5555');
INSERT INTO PHONE_NUMBERS VALUES (104, '(859) 398-3984');

INSERT INTO EMPLOYEES 
    VALUES (1, 'JOHN', CURRENT_TIMESTAMP, 1, 100);
INSERT INTO EMPLOYEES
    VALUES (2, 'JAKE', CURRENT_TIMESTAMP, 2, 101);
INSERT INTO EMPLOYEES
    VALUES (3, 'JOE', CURRENT_TIMESTAMP, 3, 102);
INSERT INTO EMPLOYEES
    VALUES (4, 'JIM', CURRENT_TIMESTAMP, 1, 103);
INSERT INTO EMPLOYEES
    VALUES (5, 'JAMES', CURRENT_TIMESTAMP, 2, 104);
    
/*Inner join: TableA INNER JOIN Table B ON FK = PK*/
SELECT E_NAME, D_NAME FROM DEPARTMENT INNER JOIN EMPLOYEES
    ON E_DEPT = D_ID;
SELECT * FROM DEPARTMENT INNER JOIN EMPLOYEES ON E_DEPT = D_ID;

/*Aliasing with Joins*/
SELECT DEPT.D_NAME, EMP.E_NAME
FROM DEPARTMENT DEPT
INNER JOIN EMPLOYEES EMP
ON EMP.E_DEPT = DEPT.D_ID;

/*Join all tables, show everyone in sales with phone number*/
SELECT E_NAME EmpName, P_NUMBER Cell
FROM DEPARTMENT INNER JOIN EMPLOYEES
ON E_DEPT = D_ID
INNER JOIN PHONE_NUMBERS
ON E_PHONE = P_ID
WHERE D_NAME = 'SALES';

/*AND, OR keywords for expressions*/
SELECT * FROM EMPLOYEES 
WHERE E_NAME = 'JOHN' OR E_NAME = 'JIM';

SELECT * FROM DEPARTMENT
WHERE D_NAME = 'SALES' OR D_ID = 2;

/*UNIONS: select statement + select statement*/
SELECT * FROM EMPLOYEES WHERE E_NAME = 'JOHN'
UNION
SELECT * FROM EMPLOYEES WHERE E_PHONE = 101;

/*Cross Joins: Cartesian joins*/
SELECT * FROM EMPLOYEES CROSS JOIN DEPARTMENT;
SELECT * FROM PHONE_NUMBERS CROSS JOIN DEPARTMENT;

/*TRUNCATE: deletes all rows, but keeps columns*/
TRUNCATE TABLE PERSON;

/*DROP: erases table from existence*/
DROP TABLE PERSON;

/*Constraints: Primary Key, Foreign Key, Not Null
    Unique, Default, Check*/
CREATE TABLE PERSON (
    P_ID INTEGER PRIMARY KEY,
    P_NAME VARCHAR2(100) NOT NULL,
    P_AGE INTEGER CHECK(P_AGE > 18),
    P_COUNTRY VARCHAR2(100) DEFAULT 'USA',
    P_SSN NUMBER UNIQUE
);

INSERT INTO PERSON VALUES (1, 'Sam', 19, '', 1);
INSERT INTO PERSON(P_ID, P_NAME, P_AGE, P_SSN)
    VALUES (2, 'John', 20, 2);
INSERT INTO PERSON VALUES (3, 'Jack', 25, 'Canada', 3);

/*IN operator: allows you to specify values in WHERE,
    same as multiple OR conditions*/
SELECT * FROM DEPARTMENT WHERE D_NAME IN ('SALES', 'HR');
SELECT * FROM EMPLOYEES WHERE E_DEPT IN
    (SELECT E_DEPT FROM EMPLOYEES WHERE E_DEPT = 1);
    
/*EXISTS operator: test for existence, returns true
    if one or more returned*/
SELECT * FROM EMPLOYEES WHERE EXISTS
    (SELECT D_NAME FROM DEPARTMENT WHERE D_ID = 2);    

Commit;
